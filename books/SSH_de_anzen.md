# SSHで安全なリモートアクセスを構築する
榊原 大輔. 株式会社ディー・アート, 2003.11.05

Finish reading at:

###### Purpose
Learn about SSH and able to setup SSH servers

## Notes
### 第1章 リモートアクセスとは何なのか
#### 1-3 リモートアクセスの利便性と危険性
- 一括操作: リモートアクセスを利用して，それぞれのコンピュータに含まれるデータを完全に同期させることができる

### 第2章 リモートアクセスにSSHを使用する理由
#### 2-1 SSHとは何か―SSHの概要
SSH: Secure Shell

SSHの3つの機能
- リモートアクセス処理
- 通信の暗号化
    - ポートフォワーディングによる他の通信プロトコルの暗号化
- 認証

#### 2-2 SSHの成り立ち
r系コマンド: UNIX系OS同士でリモートアクセスするためのコマンド

telnetやftpとの違い
- telnetはr系コマンドではrlogin, ftpはrcpで実現されている
- 一番の違いは，通信相手の想定
    - telnet, ftpは相手のコンピュータ環境は重視されない(TCP/IPプロトコルに準拠していれば通信可能)
    - r系コマンドでは相手がUNIX系OSであることを想定

代表的なr系コマンド
- rlogin: リモートログインのためのコマンド
- rcp: リモートアクセス時にファイルをコピーするためのコマンド
    - アカウント@ホスト名:ファイル名(ディレクトリ名)
    - e.g. `rcp ssh.txt user@host:/tmp`
- rsh: 接続先のコンピュータにコマンドを実行させるためのコマンド(リモートシェル)．TCP/IP標準プロトコルには対応するものがない．
    - `rsh -l user host 実行したいコマンド`
    - ローカルとリモートのユーザ名が同じなら`-l`オプションは省略できる

r系コマンドの弱点
- 認証能力がない
    - IPアドレスとユーザーの登録によって通信が可能になる．
- 暗号化されない

送信元IPアドレスの偽装は簡単(例え: 郵便物の送り元)

SSHによるr系コマンドの弱点を解決
- slogin
- scp
- ssh

#### 2-3 SSHで危険性に対応する+alpha
公開鍵暗号方式と共通鍵暗号方式による認証能力と通信の暗号化

公開鍵暗号方式: 公開鍵と秘密鍵
- 公開鍵: データの暗号化
- 秘密鍵: 暗号化されたデータの復元

SSHの通信の流れ
1. ホスト認証
2. ユーザー認証
3. 本番の通信

ホスト認証(リモートのローカルからの認証)
0. 初めてアクセスしてきた相手上のSSHに対して自分の公開鍵を渡す(リモート -> ローカル)
1. 公開鍵を使ってランダムに生成したデータを暗号化してリモートに送る
2. リモートは秘密鍵を使って暗号を解読し，そのデータをローカルに送り返す
3. ローカルは送ったデータと返ってきたデータを比較する
4. データが一致すれば，リモートは「リモートアクセスされる権利」を持つ相手だと判断できる

ユーザー認証(ローカルのリモートからの認証)
- ホスト認証と同様の仕組み(better)
- パスワードによる認証

SSHにおける共通鍵暗号方式の使われ方
- お互いが同じ鍵でデータの暗号化と復号化を行う
- 暗号化・復号化が公開鍵暗号方式よりも高速
- 共通鍵のやり取りは，公開鍵暗号方式で行う

SSHによるポートフォワーディング(+alpha)
- 他のプロトコルの通信のセキュリティレベルも上がる
- SSHの暗号化機能の1つとして扱う
- SSHの通信路を用いて転送
- 開けるファイアウォールを減らせる + 暗号化

#### 2-4 なぜ「SSH」を使うのか
- 導入が容易
- 拡張性(他のプロトコルと簡単に組み合わせられる)
- 多くのプラットフォームに対応

IPsecとの比較
- IPsecも転送中のデータを保護する
- 保護する層が異なる(IPsecはIP層，SSHはアプリケーション層)
- 前者は意識しない．後者はユーザーが意図的に使う
- IPsecは処理が重く，専用のハードウェアを必要とすることが多い
- 不特定多数のアクセスがくるサーバーなどには向かない

#### 2-5 本書で想定するネットワーク環境とSSHを取り巻く流れ
クライアント --インターネット-- ゲートウェイ - サーバ

- ルータは明記していない(どこにあっても変わらないため)

グローバルIPアドレス・プライベートIPアドレス問題
- 上を変換するためにルータが必要 -> どのように変換するのかポート番号の働きを知る

ポート番号とウェルノウンポート
- 常に開いてなければならないポートがウェルノウンポート
    - SSHでは22

ルータとポート番号とアドレス変換
- ポート22番に送られてきた通信を全てSSHサーバーに転送するようにルータを設定
- ブロードバンドルータで，ポートフォワーディングする(できないとSSH無理)

ダイナミックIPアドレス
- 一般的な常時接続サービスでは固定的なIPアドレスは割り当てられない
- 一定の周期でIPアドレスが変化(ダイナミックIPアドレス)
- ダイナミックDNSサービスを利用する or 固定IPサービスを利用する
